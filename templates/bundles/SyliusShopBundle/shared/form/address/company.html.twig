{% set form = hookable_metadata.context.form %}
{% set companyField = form.company %}
{% set nipField = form.nip %}
{% set nipWrapperId = 'nip-wrapper-' ~ nipField.vars.id %}

{{ form_row(companyField, sylius_test_form_attribute(hookable_metadata.context.type|default(null) ~ 'company')) }}

<div id="{{ nipWrapperId }}" class="mt-3" style="display: none;">
    {{ form_row(nipField, {
        label: 'NIP',
        label_attr: nipField.vars.label_attr|default({})|merge({
            class: (nipField.vars.label_attr.class|default('form-label')) ~ ' required'
        })
    }) }}
</div>

<script>
    (function() {
        const companyInput = document.getElementById('{{ companyField.vars.id }}');
        const nipWrapper = document.getElementById('{{ nipWrapperId }}');
        const nipInput = document.getElementById('{{ nipField.vars.id }}');
        const nipLabel = document.querySelector('label[for="{{ nipField.vars.id }}"]');

        function toggleNip() {
            if (!companyInput || !nipWrapper || !nipInput) {
                return;
            }

            const hasCompany = companyInput.value.trim().length > 0;
            nipWrapper.style.display = hasCompany ? '' : 'none';
            nipInput.required = hasCompany;
            if (nipLabel) {
                nipLabel.classList.toggle('required', hasCompany);
            }
        }

        if (companyInput) {
            companyInput.addEventListener('input', toggleNip);
            document.addEventListener('DOMContentLoaded', toggleNip);
            toggleNip();
        }
    })();
</script>
